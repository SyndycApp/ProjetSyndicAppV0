<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SyndicApp.Mobile.Views.Finances.PaiementsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:SyndicApp.Mobile.ViewModels.Finances"
    xmlns:models="clr-namespace:SyndicApp.Mobile.Models"
    xmlns:layouts="clr-namespace:SyndicApp.Mobile.Views.Layout"
    x:DataType="viewmodels:PaiementsListViewModel"
    BackgroundColor="White"
    Shell.NavBarIsVisible="False"
    Title="Paiements">

    <ContentPage.Resources>
        <Color x:Key="TopbarColor">#2563EB</Color>
        <Color x:Key="BodyText">#111827</Color>
    </ContentPage.Resources>

    <layouts:RoleDrawerLayout>

        <layouts:RoleDrawerLayout.MainContent>
            <Grid Padding="16" RowDefinitions="Auto,*">

                <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,12">
                    <Label Text="Paiements"
                           FontAttributes="Bold"
                           FontSize="20" />

                    <Button Grid.Column="1"
                            Text="+"
                            Command="{Binding GoToCreateCommand}"
                            BackgroundColor="{StaticResource TopbarColor}"
                            TextColor="White"
                            CornerRadius="18"
                            Padding="14,6"
                            IsVisible="{Binding IsSyndic}" />
                </Grid>

                <CollectionView Grid.Row="1"
                                ItemsSource="{Binding Items}"
                                SelectionMode="None">

                    <CollectionView.EmptyView>
                        <Label Text="Aucun paiement trouvé."
                               HorizontalOptions="Center"
                               VerticalOptions="Center" />
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:PaiementDto">
                            <Frame Padding="14" Margin="0,6" HasShadow="False" CornerRadius="12">
                                <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">

                                    <!-- Montant -->
                                    <Label Grid.ColumnSpan="2"
                                           Text="{Binding Montant, StringFormat='{0:F2} DH'}"
                                           FontAttributes="Bold"
                                           FontSize="16" />

                                    <Label Grid.Row="1"
                                           Text="{Binding NomCompletUser}"
                                           Opacity="0.8" />

                                    <!-- Tap gesture -->
                                    <Grid.GestureRecognizers>
                                        <TapGestureRecognizer
                                            Command="{Binding Source={x:Reference RootPage}, Path=BindingContext.GoToDetailsCommand}"
                                            CommandParameter="{Binding Id}" />
                                    </Grid.GestureRecognizers>

                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                </CollectionView>

            </Grid>
        </layouts:RoleDrawerLayout.MainContent>

    </layouts:RoleDrawerLayout>
</ContentPage>
