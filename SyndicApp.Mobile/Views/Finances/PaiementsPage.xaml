<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SyndicApp.Mobile.Views.Finances.PaiementsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:SyndicApp.Mobile.ViewModels.Finances"
    xmlns:models="clr-namespace:SyndicApp.Mobile.Models"
    xmlns:layouts="clr-namespace:SyndicApp.Mobile.Views.Layout"
    xmlns:behaviors="clr-namespace:SyndicApp.Mobile.Behaviors"
    x:DataType="viewmodels:PaiementsListViewModel"
    x:Name="RootPage"
    BackgroundColor="White"
    Shell.NavBarIsVisible="False"
    Title="Paiements">

    <ContentPage.Resources>

        <Color x:Key="TopbarColor">#2563EB</Color>
        <Color x:Key="DarkTitle">#111827</Color>
        <Color x:Key="SoftText">#6B7280</Color>

        <!-- Ombre douce -->
        <Style x:Key="ShadowSoft" TargetType="Frame">
            <Setter Property="Shadow">
                <Shadow Brush="#00000020"
                        Radius="14"
                        Offset="0,5"
                        Opacity="0.25"/>
            </Setter>
        </Style>

    </ContentPage.Resources>

    <layouts:RoleDrawerLayout>

        <layouts:RoleDrawerLayout.MainContent>

            <Grid Padding="16" RowDefinitions="Auto,*">

                <!-- HEADER -->
                <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,12">
                    <Label Text="Paiements"
                           FontAttributes="Bold"
                           FontSize="24"
                           TextColor="{StaticResource DarkTitle}" />

                    <Button Grid.Column="1"
                            Text="+"
                            Command="{Binding GoToCreateCommand}"
                            BackgroundColor="{StaticResource TopbarColor}"
                            TextColor="White"
                            CornerRadius="22"
                            Padding="16,8"
                            IsVisible="{Binding IsSyndic}" />
                </Grid>

                <!-- LISTE -->
                <CollectionView Grid.Row="1"
                                ItemsSource="{Binding Items}"
                                SelectionMode="None">

                    <CollectionView.ItemsLayout>
                        <GridItemsLayout 
                            Orientation="Vertical"
                            Span="{OnIdiom Phone=2, Tablet=3}"
                            HorizontalItemSpacing="16"
                            VerticalItemSpacing="16"/>
                    </CollectionView.ItemsLayout>

                    <CollectionView.EmptyView>
                        <Label Text="Aucun paiement trouvé."
                               HorizontalOptions="Center"
                               VerticalOptions="Center" />
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:PaiementDto">

                            <!-- CARD -->
                            <Frame Padding="0"
                                   Margin="0"
                                   CornerRadius="26"
                                   HasShadow="True"
                                   Style="{StaticResource ShadowSoft}"
                                   BackgroundColor="#FFFFFF">

                                <Grid Padding="18" RowDefinitions="Auto,Auto,Auto">

                                    <!-- TAP + ANIMATION APPLIQUÉS ICI -->
                                    <Grid.Behaviors>
                                        <behaviors:AnimateScaleOnTap
                                            ScaleTo="1.06"
                                            Duration="140"/>
                                    </Grid.Behaviors>

                                    <Grid.GestureRecognizers>
                                        <TapGestureRecognizer
                                            Command="{Binding Source={x:Reference RootPage}, Path=BindingContext.GoToDetailsCommand}"
                                            CommandParameter="{Binding Id}" />
                                    </Grid.GestureRecognizers>

                                    <!-- BADGE ALIGNÉ À DROITE -->
                                    <Frame Padding="6"
                                           CornerRadius="40"
                                           HorizontalOptions="End"
                                           BackgroundColor="{Binding BadgeColor}"
                                           HasShadow="False">
                                        <Label Text="{Binding Montant, StringFormat='{0:F0} DH'}"
                                               FontSize="10"
                                               FontAttributes="Bold"
                                               TextColor="White"/>
                                    </Frame>

                                    <!-- MONTANT PRINCIPAL -->
                                    <Label Grid.Row="1"
                                           Text="{Binding Montant, StringFormat='{0:F2} DH'}"
                                           FontAttributes="Bold"
                                           FontSize="17"
                                           TextColor="{StaticResource DarkTitle}" />

                                    <!-- NOM UTILISATEUR -->
                                    <Label Grid.Row="2"
                                           Text="{Binding NomCompletUser}"
                                           FontSize="14"
                                           TextColor="{StaticResource SoftText}" />

                                </Grid>

                            </Frame>

                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                </CollectionView>

            </Grid>

        </layouts:RoleDrawerLayout.MainContent>

    </layouts:RoleDrawerLayout>

</ContentPage>
