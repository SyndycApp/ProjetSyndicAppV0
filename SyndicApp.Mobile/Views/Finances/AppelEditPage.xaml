<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SyndicApp.Mobile.Views.Finances.AppelEditPage"
    x:Name="Page"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:SyndicApp.Mobile.ViewModels.Finances"
    xmlns:conv="clr-namespace:SyndicApp.Mobile.Converters"
    xmlns:layouts="clr-namespace:SyndicApp.Mobile.Views.Layout"
    x:DataType="viewmodels:AppelEditViewModel"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White"
    Title="Modifier l'appel">

    <ContentPage.Resources>
        <Color x:Key="TopbarColor">#2563EB</Color>
        <Color x:Key="HeaderTextOnDark">#FFFFFF</Color>
        <Color x:Key="BodyText">#111827</Color>
        <Color x:Key="Divider">#E5E7EB</Color>
        <Color x:Key="Chip">#F3F4F6</Color>

        <Style TargetType="Label">
            <Setter Property="TextColor" Value="{StaticResource BodyText}" />
        </Style>

        <Style TargetType="Entry">
            <Setter Property="TextColor" Value="{StaticResource BodyText}" />
            <Setter Property="BackgroundColor" Value="Transparent" />
        </Style>

        <Style TargetType="Editor">
            <Setter Property="TextColor" Value="{StaticResource BodyText}" />
            <Setter Property="BackgroundColor" Value="Transparent" />
        </Style>

        <Style TargetType="Picker">
            <Setter Property="TextColor" Value="{StaticResource BodyText}" />
        </Style>

        <Style TargetType="DatePicker">
            <Setter Property="TextColor" Value="{StaticResource BodyText}" />
        </Style>

        <conv:ProgressConverter x:Key="ProgressConverter" />
    </ContentPage.Resources>

    <layouts:RoleDrawerLayout>
        <layouts:RoleDrawerLayout.MainContent>
            <Grid RowDefinitions="Auto,*"
                  BackgroundColor="White">

                <!-- Topbar local -->
                <Grid Grid.Row="0"
                      BackgroundColor="{StaticResource TopbarColor}"
                      Padding="12,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0"
                            Text="←"
                            FontSize="22"
                            BackgroundColor="Transparent"
                            TextColor="{StaticResource HeaderTextOnDark}"
                            Clicked="OnBackClicked" />

                    <Label Grid.Column="1"
                           Text="Modifier l'appel"
                           HorizontalTextAlignment="Center"
                           VerticalOptions="Center"
                           FontAttributes="Bold"
                           TextColor="{StaticResource HeaderTextOnDark}" />
                </Grid>

                <!-- Formulaire edit -->
                <ScrollView Grid.Row="1"
                            Padding="16">

                    <VerticalStackLayout Spacing="14">

                        <!-- Résidence -->
                        <Label Text="Résidence" />
                        <Border Stroke="Black"
                                StrokeThickness="1"
                                Margin="0,2,0,8"
                                Padding="4">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <Picker
                                Title="Sélectionner une résidence"
                                ItemsSource="{Binding Residences}"
                                ItemDisplayBinding="{Binding Nom}"
                                SelectedItem="{Binding SelectedResidence}" />
                        </Border>

                        <!-- Description -->
                        <Label Text="Description" />
                        <Border Stroke="Black"
                                StrokeThickness="1"
                                Margin="0,2,0,8"
                                Padding="4">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <Editor
                                Text="{Binding Description}"
                                AutoSize="TextChanges"
                                Placeholder="Ex : Appel de fonds 1er trimestre" />
                        </Border>

                        <!-- Montant total -->
                        <Label Text="Montant total" />
                        <Border Stroke="Black"
                                StrokeThickness="1"
                                Margin="0,2,0,8"
                                Padding="4">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <Entry
                                Keyboard="Numeric"
                                Placeholder="0,00"
                                Text="{Binding MontantTotal}" />
                        </Border>

                        <!-- Nombre de paiements -->
                        <Label Text="Nombre de paiements" />
                        <Border Stroke="Black"
                                StrokeThickness="1"
                                Margin="0,2,0,8"
                                Padding="4">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <Entry
                                Keyboard="Numeric"
                                Placeholder="Ex : 3"
                                Text="{Binding NbPaiements}" />
                        </Border>

                        <!-- Date émission -->
                        <Label Text="Date d'émission" />
                        <Border Stroke="Black"
                                StrokeThickness="1"
                                Margin="0,2,0,8"
                                Padding="4">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <DatePicker
                                Date="{Binding DateEmission}" />
                        </Border>

                        <!-- Bouton enregistrer (Syndic only) -->
                        <Button Text="Enregistrer les modifications"
                                Margin="0,16,0,0"
                                CornerRadius="10"
                                Padding="14,10"
                                BackgroundColor="{StaticResource TopbarColor}"
                                TextColor="White"
                                FontAttributes="Bold"
                                Command="{Binding SaveCommand}"
                                IsVisible="{Binding IsSyndic}" />
                    </VerticalStackLayout>
                </ScrollView>
            </Grid>
        </layouts:RoleDrawerLayout.MainContent>
    </layouts:RoleDrawerLayout>
</ContentPage>
