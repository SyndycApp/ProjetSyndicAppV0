<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SyndicApp.Mobile.Views.Finances.AppelDetailsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:SyndicApp.Mobile.ViewModels.Finances"
    xmlns:layouts="clr-namespace:SyndicApp.Mobile.Views.Layout"
    xmlns:models="clr-namespace:SyndicApp.Mobile.Models"
    x:DataType="viewmodels:AppelDetailsViewModel"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <layouts:RoleDrawerLayout>
        <layouts:RoleDrawerLayout.MainContent>

            <ScrollView>
                <VerticalStackLayout Padding="16" Spacing="20">

                    <!-- RETOUR -->
                    <Grid ColumnDefinitions="Auto,*">
                        <Button Text="←"
                                FontSize="28"
                                BackgroundColor="Transparent"
                                Clicked="OnBackClicked"/>

                        <Label Grid.Column="1"
                               Text="Détail de l'appel"
                               HorizontalTextAlignment="Center"
                               VerticalTextAlignment="Center"
                               FontSize="22"
                               FontAttributes="Bold"/>
                    </Grid>

                    <!-- TITRE -->
                    <Label Text="{Binding Appel.Description}"
                           FontSize="30"
                           FontAttributes="Bold"/>

                    <!-- CARTE INFO -->
                    <Frame Padding="16"
                           CornerRadius="16"
                           BorderColor="#D0D0D0">

                        <VerticalStackLayout Spacing="12">

                            <Label Text="{Binding Appel.DateEmission, StringFormat='{0:dd/MM/yyyy}'}"
                                   FontSize="16"/>

                            <Grid ColumnDefinitions="*,*,*">

                                <VerticalStackLayout>
                                    <Label Text="Montant total" FontSize="12"/>
                                    <Label Text="{Binding Appel.MontantTotal, StringFormat='{0:N2} €'}"
                                           FontSize="18"
                                           FontAttributes="Bold"/>
                                </VerticalStackLayout>

                                <VerticalStackLayout Grid.Column="1">
                                    <Label Text="Payé" FontSize="12"/>
                                    <Label Text="{Binding Appel.MontantPaye, StringFormat='{0:N2} €'}"
                                           FontSize="18"
                                           FontAttributes="Bold"/>
                                </VerticalStackLayout>

                                <VerticalStackLayout Grid.Column="2">
                                    <Label Text="Restant" FontSize="12"/>
                                    <Label Text="{Binding Appel.MontantReste, StringFormat='{0:N2} €'}"
                                           FontSize="18"
                                           FontAttributes="Bold"/>
                                </VerticalStackLayout>

                            </Grid>
                        </VerticalStackLayout>

                    </Frame>

                    <!-- SECTION PAIEMENTS -->
                    <Label Text="Paiements"
                           FontSize="26"
                           FontAttributes="Bold"/>

                    <Label Text="{Binding Paiements.Count, StringFormat='Nb paiements : {0}'}"
                           TextColor="Red"
                           FontAttributes="Bold"/>

                    <!-- LISTE DES PAIEMENTS -->
                    <CollectionView ItemsSource="{Binding Paiements}"
                                    SelectionMode="None"
                                    Margin="0,10">

                        <CollectionView.EmptyView>
                            <Label Text="Aucun paiement"
                                   FontSize="14"
                                   HorizontalTextAlignment="Center"
                                   TextColor="#777"/>
                        </CollectionView.EmptyView>

                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:PaiementDto">

                                <Frame Padding="14"
                                       CornerRadius="14"
                                       BorderColor="#D0D0D0"
                                       Margin="0,6">

                                    <Grid ColumnDefinitions="40,*,Auto">

                                        <Label Text="€"
                                               FontSize="24"
                                               VerticalOptions="Center"
                                               HorizontalOptions="Center"/>

                                        <VerticalStackLayout Grid.Column="1">
                                            <Label Text="{Binding NomCompletUser}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"/>
                                            <Label Text="{Binding DatePaiement, StringFormat='{0:dd/MM/yyyy}'}"
                                                   FontSize="13"
                                                   TextColor="#777"/>
                                        </VerticalStackLayout>

                                        <Label Grid.Column="2"
                                               Text="{Binding Montant, StringFormat='{0:N2} €'}"
                                               FontSize="17"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center"/>
                                    </Grid>

                                </Frame>

                            </DataTemplate>
                        </CollectionView.ItemTemplate>

                    </CollectionView>


                    <!-- ACTIONS SYNDIC -->
                    <Grid ColumnDefinitions="*,*,*"
                          Margin="0,10"
                          IsVisible="{Binding IsSyndic}">

                        <Button Text="Clôturer"
                                Command="{Binding CloturerCommand}"
                                BackgroundColor="#4F46E5"
                                TextColor="White"
                                CornerRadius="18"/>

                        <Button Grid.Column="1"
                                Text="Modifier"
                                Command="{Binding EditCommand}"
                                BackgroundColor="#4F46E5"
                                TextColor="White"
                                CornerRadius="18"/>

                        <Button Grid.Column="2"
                                Text="Supprimer"
                                Command="{Binding DeleteCommand}"
                                BackgroundColor="#4F46E5"
                                TextColor="Red"
                                CornerRadius="18"/>

                    </Grid>

                    <!-- DESCRIPTION -->
                    <Label Text="Description"
                           FontAttributes="Bold"
                           FontSize="22"/>

                    <Frame Padding="12"
                           BorderColor="#D0D0D0"
                           CornerRadius="10">

                        <Label Text="{Binding Appel.Description}"
                               FontSize="16"/>
                    </Frame>

                </VerticalStackLayout>
            </ScrollView>

        </layouts:RoleDrawerLayout.MainContent>
    </layouts:RoleDrawerLayout>

</ContentPage>
