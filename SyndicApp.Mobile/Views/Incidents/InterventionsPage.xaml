<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SyndicApp.Mobile.Views.Incidents.InterventionsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:SyndicApp.Mobile.ViewModels.Incidents"
    xmlns:layout="clr-namespace:SyndicApp.Mobile.Views.Layout"
    xmlns:models="clr-namespace:SyndicApp.Mobile.Models"
    x:DataType="vm:InterventionsListViewModel"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <layout:RoleDrawerLayout x:Name="DrawerLayout">
        <layout:RoleDrawerLayout.MainContent>

            <!-- ==== CONTENU DE LA PAGE ==== -->
            <Grid Padding="16" RowDefinitions="Auto,*">

                <!-- TITRE + REFRESH -->
                <Grid ColumnDefinitions="*,Auto" Padding="0,0,0,12">
                    <Label Text="Interventions"
                           FontSize="20"
                           FontAttributes="Bold"/>

                    <Button Grid.Column="1"
                            Text="⟳"
                            FontSize="18"
                            BackgroundColor="Transparent"
                            Command="{Binding RefreshCommand}" />
                </Grid>

                <!-- LISTE -->
                <CollectionView Grid.Row="1"
                                ItemsSource="{Binding Items}"
                                SelectionMode="None">

                    <CollectionView.EmptyView>
                        <Grid Padding="24" VerticalOptions="Center">
                            <Label Text="Aucune intervention."
                                   HorizontalTextAlignment="Center"
                                   Opacity="0.6"/>
                        </Grid>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:InterventionDto">

                            <Frame BorderColor="#E5E7EB"
                                   CornerRadius="14"
                                   Padding="14"
                                   Margin="0,6">

                                <VerticalStackLayout Spacing="6">

                                    <Label Text="{Binding DescriptionSansGuid}"
                                           FontAttributes="Bold"/>

                                    <Label Text="{Binding Statut}"
                                           FontAttributes="Bold"
                                           TextColor="#2563EB"/>

                                    <Label Text="{Binding DatePrevue, StringFormat='Prévue : {0:dd/MM/yyyy HH\\:mm}'}"
                                           Opacity="0.7"/>

                                    <Label Text="{Binding DateRealisation, StringFormat='Réalisation : {0:dd/MM/yyyy HH\\:mm}'}"
                                           Opacity="0.7"/>

                                   <Button Text="Détails"
                                           BackgroundColor="Transparent"
                                           TextColor="#2563EB"
                                           BorderColor="#2563EB"
                                           BorderWidth="1"
                                           CornerRadius="10"
                                           Padding="10,6"
                                           Command="{Binding BindingContext.GoToDetailsCommand, Source={x:Reference DrawerLayout}}"
                                           CommandParameter="{Binding Id}" />
                                </VerticalStackLayout>

                            </Frame>

                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                </CollectionView>

            </Grid>

        </layout:RoleDrawerLayout.MainContent>
    </layout:RoleDrawerLayout>
</ContentPage>
