<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SyndicApp.Mobile.Views.Incidents.InterventionDetailsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:SyndicApp.Mobile.ViewModels.Incidents"
    xmlns:layout="clr-namespace:SyndicApp.Mobile.Views.Layout"
    x:DataType="vm:InterventionDetailsViewModel"
    x:Name="ThisPage"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <layout:RoleDrawerLayout x:Name="DrawerLayout">
        <layout:RoleDrawerLayout.MainContent>

            <ScrollView>
                <VerticalStackLayout Padding="16" Spacing="16">

                    <!-- 🔵 HEADER : flèche + titre -->
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Button 
                            Grid.Column="0"
                            Text="←"
                            FontSize="22"
                            BackgroundColor="Transparent"
                            TextColor="Black"
                            Clicked="Back_Clicked"
                            Padding="0"
                            />

                        <Label 
                            Grid.Column="1"
                            Text="Détails intervention"
                            FontSize="22"
                            FontAttributes="Bold"
                            HorizontalTextAlignment="Center"
                            VerticalOptions="Center"
                            />

                        <Label Grid.Column="2" Text="" /> 
                    </Grid>

                    <ActivityIndicator 
                        IsRunning="{Binding IsBusy}"
                        IsVisible="{Binding IsBusy}" />

                    <!-- DESCRIPTION -->
                    <Frame Padding="14" BorderColor="#E5E7EB" CornerRadius="14">
                        <VerticalStackLayout Spacing="8">

                            <Label Text="Description" FontAttributes="Bold" />
                            <Label Text="{Binding Item.DescriptionSansGuid}" />

                            <BoxView HeightRequest="1" BackgroundColor="#E5E7EB" />

                            <Label Text="Statut" FontAttributes="Bold" />
                            <Label Text="{Binding Item.Statut}" />
                        </VerticalStackLayout>
                    </Frame>

                    <!-- DATES -->
                    <Frame Padding="14" BorderColor="#E5E7EB" CornerRadius="14">
                        <VerticalStackLayout>
                            <Label Text="Dates" FontAttributes="Bold" />
                            <Label Text="{Binding Item.DatePrevue, StringFormat='Prévue : {0:dd/MM/yyyy HH\\:mm}'}" Opacity="0.7" />
                            <Label Text="{Binding Item.DateRealisation, StringFormat='Réalisation : {0:dd/MM/yyyy HH\\:mm}'}" Opacity="0.7" />
                        </VerticalStackLayout>
                    </Frame>

                    <!-- COUTS -->
                    <Frame Padding="14" BorderColor="#E5E7EB" CornerRadius="14">
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Coûts" FontAttributes="Bold" />
                            <Label Text="{Binding Item.CoutEstime, StringFormat='Coût estimé : {0:F2}'}" Opacity="0.7"/>
                            <Label Text="{Binding Item.CoutReel, StringFormat='Coût réel : {0:F2}'}" Opacity="0.7"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- ACTIONS -->
                    <Frame Padding="14" BorderColor="#E5E7EB" CornerRadius="14">
                        <VerticalStackLayout Spacing="12">
                            <Label Text="Actions" FontAttributes="Bold" />

                            <HorizontalStackLayout Spacing="10">

                                <Button 
                                    Text="Démarrer"
                                    Command="{Binding StartCommand}"
                                    BackgroundColor="#2563EB"
                                    TextColor="White"
                                    CornerRadius="10"
                                    Padding="14,6"
                                    />

                                <!-- 🔵 STYLE IDENTIQUE A “Détails” -->
                                <Button 
                                    Text="Terminer"
                                    Command="{Binding CompleteCommand}"
                                    BackgroundColor="Transparent"
                                    TextColor="#2563EB"
                                    BorderColor="#2563EB"
                                    BorderWidth="1"
                                    CornerRadius="10"
                                    Padding="10,6"
                                    />

                                <Button 
                                    Text="Annuler"
                                    Command="{Binding CancelCommand}"
                                    BackgroundColor="#DC2626"
                                    TextColor="White"
                                    CornerRadius="10"
                                    Padding="14,6"
                                    />
                            </HorizontalStackLayout>

                        </VerticalStackLayout>
                    </Frame>

                </VerticalStackLayout>
            </ScrollView>

        </layout:RoleDrawerLayout.MainContent>
    </layout:RoleDrawerLayout>

</ContentPage>
