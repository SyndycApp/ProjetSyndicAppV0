<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SyndicApp.Mobile.Views.Personnel.PrestatairesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:SyndicApp.Mobile.ViewModels.Personnel"
    xmlns:models="clr-namespace:SyndicApp.Mobile.Models"
    xmlns:layout="clr-namespace:SyndicApp.Mobile.Views.Layout"
    x:DataType="vm:PrestatairesListViewModel"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <layout:RoleDrawerLayout x:Name="DrawerLayout">

        <layout:RoleDrawerLayout.MainContent>

            <Grid Padding="16" RowDefinitions="Auto,*">

                <!-- ENTÊTE SIMPLIFIÉE → le bouton ☰ est dans RoleDrawerLayout -->
                <Grid ColumnDefinitions="*,Auto" Padding="0,0,0,12">
                    <Label Text="Prestataires"
                           FontAttributes="Bold"
                           FontSize="22" />

                    <!-- Bouton ajouter -->
                    <Button Grid.Column="1"
                            Text="+"
                            FontSize="22"
                            BackgroundColor="Transparent"
                            TextColor="#2563EB"
                            Command="{Binding GoToCreateCommand}" />
                </Grid>

                <!-- LISTE -->
                <CollectionView Grid.Row="1"
                                ItemsSource="{Binding Items}"
                                SelectionMode="None">

                    <CollectionView.EmptyView>
                        <Grid Padding="24" VerticalOptions="Center">
                            <Label Text="Aucun prestataire."
                                   HorizontalTextAlignment="Center"
                                   Opacity="0.6"/>
                        </Grid>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:PrestataireDto">
                            <Frame CornerRadius="14"
                                   BorderColor="#E5E7EB"
                                   Padding="14"
                                   Margin="0,6">

                                <Grid RowDefinitions="Auto,Auto,Auto"
                                      ColumnDefinitions="*,Auto">

                                    <Label Grid.Row="0" Grid.Column="0"
                                           Text="{Binding Nom}"
                                           FontAttributes="Bold"/>

                                    <Label Grid.Row="0" Grid.Column="1"
                                           Text="{Binding NbInterventions, StringFormat='{0} int.'}"
                                           Opacity="0.7"
                                           HorizontalTextAlignment="End"/>

                                    <Grid Grid.Row="1"
                                          Grid.ColumnSpan="2"
                                          ColumnDefinitions="*,*"
                                          Margin="0,8,0,0">
                                        <Label Text="{Binding TypeService}" />
                                        <Label Grid.Column="1"
                                               Text="{Binding Telephone}"
                                               HorizontalTextAlignment="End" />
                                    </Grid>

                                    <Grid Grid.Row="2"
                                          Grid.ColumnSpan="2"
                                          ColumnDefinitions="*,Auto"
                                          Margin="0,10,0,0">
                                        <Label Text="{Binding Email}" Opacity="0.7" />

                                        <Button Grid.Column="1"
                                                Text="Détails"
                                                Command="{Binding BindingContext.GoToDetailsCommand, Source={x:Reference DrawerLayout}}"
                                                CommandParameter="{Binding Id}" />
                                    </Grid>

                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </Grid>

        </layout:RoleDrawerLayout.MainContent>
    </layout:RoleDrawerLayout>
</ContentPage>
