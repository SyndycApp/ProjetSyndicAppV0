<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SyndicApp.Mobile.Views.Lots.LotsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:layout="clr-namespace:SyndicApp.Mobile.Views.Layout"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <layout:RoleDrawerLayout>
        <layout:RoleDrawerLayout.MainContent>

            <!-- PAGE FULL -->
            <Grid RowDefinitions="Auto,*"
                  BackgroundColor="White">

                <!-- HEADER (ne scrolle pas) -->
                <VerticalStackLayout Padding="16" Spacing="12">

                    <Grid ColumnDefinitions="*,Auto">
                        <Label Text="Liste des lots"
                               FontSize="22"
                               FontAttributes="Bold" />

                        <Button x:Name="BtnAddLot"
                                Grid.Column="1"
                                Text="+"
                                BackgroundColor="#2563EB"
                                TextColor="White"
                                CornerRadius="12"
                                Padding="14,6"
                                Clicked="OnAddLotClicked" />
                    </Grid>

                </VerticalStackLayout>

                <!-- LISTE SCROLLABLE -->
                <CollectionView Grid.Row="1"
                                ItemsSource="{Binding Items}"
                                SelectionMode="None"
                                Margin="16,0">

                    <CollectionView.EmptyView>
                        <Label Text="Aucun lot"
                               HorizontalOptions="Center"
                               VerticalOptions="Center" />
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Margin="0,6"
                                   Padding="14"
                                   CornerRadius="12"
                                   HasShadow="False"
                                   BorderColor="#E5E7EB">

                                <Grid ColumnDefinitions="*,Auto">
                                    <VerticalStackLayout Spacing="2">
                                        <Label Text="{Binding NumeroLot}"
                                               FontAttributes="Bold"
                                               FontSize="16" />

                                        <Label Text="{Binding Type}"
                                               FontSize="12"
                                               TextColor="#6B7280" />

                                        <Label Text="{Binding StatutOccupation}"
                                               FontSize="12">
                                            <Label.Triggers>
                                                <DataTrigger TargetType="Label"
                                                             Binding="{Binding EstOccupe}"
                                                             Value="True">
                                                    <Setter Property="TextColor" Value="#16A34A" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label"
                                                             Binding="{Binding EstOccupe}"
                                                             Value="False">
                                                    <Setter Property="TextColor" Value="#6B7280" />
                                                </DataTrigger>
                                            </Label.Triggers>
                                        </Label>

                                        <Label Text="{Binding OccupantDisplay}"
                                               FontSize="11"
                                               TextColor="#6B7280" />
                                    </VerticalStackLayout>

                                    <Label Grid.Column="1"
                                           Text="›"
                                           FontSize="22"
                                           VerticalOptions="Center"
                                           TextColor="#9CA3AF" />
                                </Grid>

                                <!-- Tap : ouvrir détails -->
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}},
                                                          Path=BindingContext.OpenDetailsAsyncCommand}"
                                        CommandParameter="{Binding Id}" />
                                </Frame.GestureRecognizers>

                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </Grid>

        </layout:RoleDrawerLayout.MainContent>
    </layout:RoleDrawerLayout>
</ContentPage>
