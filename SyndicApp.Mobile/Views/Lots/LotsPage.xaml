<?xml version="1.0" encoding="utf-8"?>
<ContentPage x:Class="SyndicApp.Mobile.Views.Lots.LotsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Shell.NavBarIsVisible="False"
             Title="Lots"
             BackgroundColor="White">

  <ContentPage.Resources>
    <Color x:Key="TopbarColor">#2563EB</Color>
    <Color x:Key="HeaderTextOnDark">#FFFFFF</Color>
    <Color x:Key="BodyText">#111827</Color>
    <Color x:Key="Divider">#E5E7EB</Color>

    <Style TargetType="Label">
      <Setter Property="TextColor" Value="{StaticResource BodyText}" />
    </Style>

    <Style x:Key="MenuButtonStyle" TargetType="Button">
      <Setter Property="BackgroundColor" Value="Transparent" />
      <Setter Property="TextColor" Value="{StaticResource BodyText}" />
      <Setter Property="CornerRadius" Value="8" />
      <Setter Property="Padding" Value="12,8" />
      <Setter Property="HorizontalOptions" Value="Start" />
    </Style>

    <Style x:Key="LogoutButtonStyle" TargetType="Button" BasedOn="{StaticResource MenuButtonStyle}">
      <Setter Property="BackgroundColor" Value="#F3F4F6" />
    </Style>
  </ContentPage.Resources>

  <Grid x:Name="Root" RowDefinitions="Auto,*" BackgroundColor="White">
    <Grid BackgroundColor="{StaticResource TopbarColor}" Padding="12,8">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <Button Grid.Column="0" Text="&#x2630;" FontSize="22"
              BackgroundColor="Transparent"
              TextColor="{StaticResource HeaderTextOnDark}"
              Clicked="OpenDrawer_Clicked" />

      <Label Grid.Column="1" Text="Lots"
             HorizontalTextAlignment="Center"
             VerticalOptions="Center"
             FontAttributes="Bold"
             TextColor="{StaticResource HeaderTextOnDark}" />

      <Label Grid.Column="2" Text="&#x2022; &#x2022; &#x2022;"
             TextColor="{StaticResource HeaderTextOnDark}"
             VerticalOptions="Center" />
    </Grid>

    <Grid Grid.Row="1">
      <VerticalStackLayout Padding="16" Spacing="12">
        <Grid ColumnDefinitions="*,Auto">
          <Label Text="Liste des lots" FontSize="22" FontAttributes="Bold" />
          <Button Grid.Column="1" Text="+" BackgroundColor="#2563EB" TextColor="White"
                  CornerRadius="12" Padding="14,6"
                  Command="{Binding OpenCreateAsyncCommand}" />
        </Grid>

        <CollectionView ItemsSource="{Binding Items}" SelectionMode="None">
          <CollectionView.EmptyView>
            <Label Text="Aucun lot" HorizontalOptions="Center" VerticalOptions="Center" />
          </CollectionView.EmptyView>
          <CollectionView.ItemTemplate>
            <DataTemplate>
              <Frame Margin="0,6" Padding="14" CornerRadius="12" HasShadow="False" BorderColor="#E5E7EB">
                <Grid ColumnDefinitions="*,Auto">
                  <VerticalStackLayout Spacing="2">
                    <Label Text="{Binding NumeroLot}" FontAttributes="Bold" FontSize="16" />
                    <Label Text="{Binding Type}" FontSize="12" TextColor="#6B7280" />
                  </VerticalStackLayout>
                  <Label Grid.Column="1" Text="&#x203A;" FontSize="22" VerticalOptions="Center" TextColor="#9CA3AF" />
                </Grid>
                <Frame.GestureRecognizers>
                  <TapGestureRecognizer
                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.OpenDetailsAsyncCommand}"
                    CommandParameter="{Binding Id}" />
                </Frame.GestureRecognizers>
              </Frame>
            </DataTemplate>
          </CollectionView.ItemTemplate>
        </CollectionView>
      </VerticalStackLayout>
    </Grid>

    <BoxView x:Name="Backdrop" Grid.RowSpan="2" BackgroundColor="#66000000" Opacity="0" InputTransparent="True">
      <BoxView.GestureRecognizers><TapGestureRecognizer Tapped="Backdrop_Tapped"/></BoxView.GestureRecognizers>
    </BoxView>

    <Border x:Name="Drawer" Grid.RowSpan="2" BackgroundColor="White" StrokeThickness="0" TranslationX="-1000" Padding="0">
      <Grid RowDefinitions="Auto,*">
        <Grid BackgroundColor="{StaticResource TopbarColor}" Padding="16">
          <Grid.ColumnDefinitions><ColumnDefinition Width="*"/><ColumnDefinition Width="Auto"/></Grid.ColumnDefinitions>
          <Label Text="Navigation" TextColor="{StaticResource HeaderTextOnDark}" FontAttributes="Bold" VerticalOptions="Center" />
          <Button Grid.Column="1" Text="&#x2192;" FontSize="22" BackgroundColor="Transparent"
                  TextColor="{StaticResource HeaderTextOnDark}" Clicked="CloseDrawer_Clicked" />
        </Grid>

        <ScrollView Grid.Row="1" BackgroundColor="White">
          <VerticalStackLayout Padding="16" Spacing="10">
            <Label Text="Tableau de bord" FontAttributes="Bold" />
            <Button Text="Dashboard" Style="{StaticResource MenuButtonStyle}" CommandParameter="//syndic-dashboard" Clicked="OnMenuItemClicked"/>
                <Button Text="Dashboard Affectations"
            Style="{StaticResource MenuButtonStyle}"
            CommandParameter="//affectation-dashboard"
            Clicked="OnMenuItemClicked"/>
            <BoxView HeightRequest="1" BackgroundColor="{StaticResource Divider}" />
            <Label Text="Residences et Lots" FontAttributes="Bold" />
            <Button Text="Residences" Style="{StaticResource MenuButtonStyle}" CommandParameter="//residences" Clicked="OnMenuItemClicked"/>
            <Button Text="Batiments" Style="{StaticResource MenuButtonStyle}" CommandParameter="//batiments" Clicked="OnMenuItemClicked"/>
            <Button Text="Lots" Style="{StaticResource MenuButtonStyle}" CommandParameter="//lots" Clicked="OnMenuItemClicked"/>
            <Button Text="Affectations des lots" Style="{StaticResource MenuButtonStyle}" CommandParameter="//affectations-lots" Clicked="OnMenuItemClicked"/>
            <Button Text="Occupant actuel" Style="{StaticResource MenuButtonStyle}" CommandParameter="//lots/occupant-actuel" Clicked="OnMenuItemClicked"/>
            <Button Text="Historique affectations" Style="{StaticResource MenuButtonStyle}" CommandParameter="//lots/affectations/historique" Clicked="OnMenuItemClicked"/>

            <BoxView HeightRequest="1" BackgroundColor="{StaticResource Divider}" />
            <Label Text="Finances" FontAttributes="Bold" />
            <Button Text="Appels de fonds" Style="{StaticResource MenuButtonStyle}" CommandParameter="//appels" Clicked="OnMenuItemClicked"/>
            <Button Text="Creer un appel" Style="{StaticResource MenuButtonStyle}" CommandParameter="appel-create" Clicked="OnMenuItemClicked"/>
            <Button Text="Modifier un appel" Style="{StaticResource MenuButtonStyle}" CommandParameter="appel-edit" Clicked="OnMenuItemClicked"/>
            <Button Text="Details d un appel" Style="{StaticResource MenuButtonStyle}" CommandParameter="appel-details" Clicked="OnMenuItemClicked"/>

            <BoxView HeightRequest="16" Opacity="0" />
            <Button Text="Deconnexion" Style="{StaticResource LogoutButtonStyle}" CommandParameter="//login" Clicked="OnMenuItemClicked"/>
          </VerticalStackLayout>
        </ScrollView>
      </Grid>
    </Border>
  </Grid>
</ContentPage>
