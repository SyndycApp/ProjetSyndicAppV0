<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    x:Class="SyndicApp.Mobile.Views.Dashboard.SyndicDashboardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:layout="clr-namespace:SyndicApp.Mobile.Views.Layout"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <layout:RoleDrawerLayout x:Name="DrawerLayout">

        <layout:RoleDrawerLayout.MainContent>

            <ScrollView>
                <VerticalStackLayout Padding="20" Spacing="20">

                    <Label Text="Dashboard Syndic"
                           FontSize="22"
                           FontAttributes="Bold" />

                    <!-- KPIs principaux -->
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto"
                          ColumnSpacing="12" RowSpacing="12">

                        <Frame Style="{StaticResource KpiCardStyle}" Grid.Row="0" Grid.Column="0">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding ResidencesCount}" Style="{StaticResource KpiValueStyle}"/>
                                <Label Text="Résidences" Style="{StaticResource KpiLabelStyle}"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Style="{StaticResource KpiCardStyle}" Grid.Row="0" Grid.Column="1">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding LotsCount}" Style="{StaticResource KpiValueStyle}"/>
                                <Label Text="Lots" Style="{StaticResource KpiLabelStyle}"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Style="{StaticResource KpiCardStyle}" Grid.Row="1" Grid.Column="0">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding BatimentsCount}" Style="{StaticResource KpiValueStyle}"/>
                                <Label Text="Bâtiments" Style="{StaticResource KpiLabelStyle}"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Style="{StaticResource KpiCardStyle}" Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding IncidentsOuverts}" Style="{StaticResource KpiValueStyle}"/>
                                <Label Text="Incidents ouverts" Style="{StaticResource KpiLabelStyle}"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Style="{StaticResource KpiCardStyle}" Grid.Row="3" Grid.Column="0">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding InterventionsEnCours}" Style="{StaticResource KpiValueStyle}"/>
                                <Label Text="Interventions en cours" Style="{StaticResource KpiLabelStyle}"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Style="{StaticResource KpiCardStyle}" Grid.Row="3" Grid.Column="1">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding AppelsOuverts}" Style="{StaticResource KpiValueStyle}"/>
                                <Label Text="Appels de fonds (total)" Style="{StaticResource KpiLabelStyle}"/>
                            </VerticalStackLayout>
                        </Frame>
                    </Grid>

                    <!-- Finances -->
                    <VerticalStackLayout Spacing="12">

                        <Frame Style="{StaticResource KpiCardStyle}">
                            <VerticalStackLayout Spacing="8">
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Text="Taux de recouvrement" />
                                    <Label Grid.Column="1"
                                           Text="{Binding TauxRecouvrementPct}"
                                           FontAttributes="Bold"/>
                                </Grid>
                                <ProgressBar Progress="{Binding TauxRecouvrement}"
                                             HeightRequest="8"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Style="{StaticResource KpiCardStyle}">
                            <VerticalStackLayout Spacing="8">
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Text="Résolution des incidents" />
                                    <Label Grid.Column="1"
                                           Text="{Binding TauxResolutionIncidentsPct}"
                                           FontAttributes="Bold"/>
                                </Grid>
                                <ProgressBar Progress="{Binding TauxResolutionIncidents}"
                                             HeightRequest="8"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Style="{StaticResource KpiCardStyle}">
                            <VerticalStackLayout Spacing="8">
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Text="Taux d’occupation des lots" />
                                    <Label Grid.Column="1"
                                           Text="{Binding TauxOccupationPct}"
                                           FontAttributes="Bold"/>
                                </Grid>
                                <ProgressBar Progress="{Binding TauxOccupation}"
                                             HeightRequest="8"/>
                            </VerticalStackLayout>
                        </Frame>

                    </VerticalStackLayout>

                    <!-- Charges -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12" RowSpacing="12">

                        <Frame Style="{StaticResource KpiCardStyle}" Grid.Column="0">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding ChargesCount}" Style="{StaticResource KpiValueStyle}"/>
                                <Label Text="Charges (nombre)" Style="{StaticResource KpiLabelStyle}"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Style="{StaticResource KpiCardStyle}" Grid.Column="1">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding ChargesMontantTotal, StringFormat='{0:N0} MAD'}"
                                       Style="{StaticResource KpiValueStyle}"/>
                                <Label Text="Montant total des charges" Style="{StaticResource KpiLabelStyle}"/>
                            </VerticalStackLayout>
                        </Frame>

                    </Grid>

                    <!-- Docs / notifs -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12" RowSpacing="12">

                        <Frame Style="{StaticResource KpiCardStyle}" Grid.Column="0">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding DocumentsCount}" Style="{StaticResource KpiValueStyle}"/>
                                <Label Text="Documents" Style="{StaticResource KpiLabelStyle}"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Style="{StaticResource KpiCardStyle}" Grid.Column="1">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding NotificationsNonLues}" Style="{StaticResource KpiValueStyle}"/>
                                <Label Text="Notifications non lues" Style="{StaticResource KpiLabelStyle}"/>
                            </VerticalStackLayout>
                        </Frame>

                    </Grid>

                </VerticalStackLayout>
            </ScrollView>

        </layout:RoleDrawerLayout.MainContent>

    </layout:RoleDrawerLayout>
</ContentPage>
