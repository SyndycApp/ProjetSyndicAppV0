<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SyndicApp.Mobile.Views.Dashboard.AffectationUserDashboardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:layout="clr-namespace:SyndicApp.Mobile.Views.Layout"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <layout:RoleDrawerLayout x:Name="DrawerLayout">

        <layout:RoleDrawerLayout.MainContent>

            <ScrollView Padding="16">
                <VerticalStackLayout Spacing="16">

                    <Label Text="Mes affectations"
                           FontSize="22"
                           FontAttributes="Bold" />

                    <!-- KPIs -->
                    <Frame Style="{StaticResource Card}">
                        <Grid ColumnDefinitions="*,Auto"
                              RowDefinitions="Auto,Auto,Auto"
                              ColumnSpacing="8">

                            <Label Text="Nombre de mes lots" FontAttributes="Bold" />
                            <Label Grid.Row="1" Text="Affectations actives" />
                            <Label Grid.Row="2" Text="Fin la plus proche" />

                            <Label Grid.Column="1"
                                   Text="{Binding MyLotsCount}"
                                   FontAttributes="Bold" />

                            <Label Grid.Column="1"
                                   Grid.Row="1"
                                   Text="{Binding MyActives}"
                                   FontAttributes="Bold" />

                            <Label Grid.Column="1"
                                   Grid.Row="2"
                                   Text="{Binding NextEndingText}"
                                   FontAttributes="Bold" />

                        </Grid>
                    </Frame>

                    <!-- Liste -->
                    <Frame Style="{StaticResource Card}">
                        <VerticalStackLayout>

                            <Label Text="Mes affectations"
                                   FontAttributes="Bold" />

                            <CollectionView ItemsSource="{Binding MyItems}"
                                            SelectionMode="None">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="*,Auto"
                                              Padding="0,6">
                                            <VerticalStackLayout>
                                                <Label Text="{Binding LotNumero}"
                                                       FontAttributes="Bold" />
                                                <Label Text="{Binding DateDebut, StringFormat='Début : {0:dd/MM/yyyy}'}"
                                                       Opacity="0.7" />
                                            </VerticalStackLayout>

                                            <Label Grid.Column="1"
                                                   Text="{Binding Statut}" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>

                            <Button Text="Actualiser"
                                    Style="{StaticResource OutlineButton}"
                                    Command="{Binding LoadCommand}" />

                        </VerticalStackLayout>
                    </Frame>

                </VerticalStackLayout>
            </ScrollView>

        </layout:RoleDrawerLayout.MainContent>

    </layout:RoleDrawerLayout>

</ContentPage>
