<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    x:Class="SyndicApp.Mobile.Views.Communication.ConversationsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:SyndicApp.Mobile.ViewModels.Communication"
    xmlns:layout="clr-namespace:SyndicApp.Mobile.Views.Layout"
    x:DataType="vm:ConversationsListViewModel"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <layout:RoleDrawerLayout x:Name="DrawerLayout">

        <layout:RoleDrawerLayout.MainContent>

            <Grid RowDefinitions="Auto,*" Padding="16">

                <!-- HEADER -->
                <Label Text="Conversations"
                       FontAttributes="Bold"
                       FontSize="26"
                       TextColor="#111827"
                       Margin="0,0,0,12"/>

                <!-- LISTE DES CONVERSATIONS -->
                <CollectionView Grid.Row="1"
                                ItemsSource="{Binding Conversations}"
                                SelectionMode="Single"
                                SelectedItem="{Binding SelectedConversation, Mode=TwoWay}"
                                SelectionChangedCommand="{Binding OpenConversationCommand}"
                                SelectionChangedCommandParameter="{Binding SelectedConversation}">

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="10"
                                  ColumnDefinitions="60,*"
                                  RowDefinitions="Auto,Auto"
                                  Margin="0,0,0,10"
                                  BackgroundColor="#F9FAFB"
                                  Stroke="#E5E7EB"
                                  StrokeThickness="1"
                                  StrokeShape="RoundRectangle 12">

                                <!-- AVATAR -->
                                <Frame WidthRequest="48" HeightRequest="48"
                                       CornerRadius="24"
                                       BackgroundColor="#2563EB"
                                       VerticalOptions="Center">
                                    <Label Text="{Binding Participants[1].NomComplet, StringFormat='{}{0.Substring(0,1)}'}"
                                           TextColor="White"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"
                                           FontAttributes="Bold"
                                           FontSize="20"/>
                                </Frame>

                                <!-- TITRE + DERNIER MESSAGE -->
                                <VerticalStackLayout Grid.Column="1" Spacing="4">

                                    <Label Text="{Binding Participants[1].NomComplet}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="#111827"/>

                                    <Label Text="{Binding DernierMessage.Contenu}"
                                           MaxLines="1"
                                           TextColor="#6B7280"
                                           FontSize="14"/>

                                </VerticalStackLayout>

                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                </CollectionView>

            </Grid>

        </layout:RoleDrawerLayout.MainContent>
    </layout:RoleDrawerLayout>
</ContentPage>
