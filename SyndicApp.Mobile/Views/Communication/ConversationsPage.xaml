<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    x:Class="SyndicApp.Mobile.Views.Communication.ConversationsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:SyndicApp.Mobile.ViewModels.Communication"
    xmlns:converters="clr-namespace:SyndicApp.Mobile.Converters"
    x:DataType="vm:ConversationsListViewModel"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <ContentPage.Resources>
        <converters:MessageSeenIconConverter x:Key="MessageSeenIconConverter" />
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*">

        <Label Text="Conversations"
               FontAttributes="Bold"
               FontSize="26"
               TextColor="#111827"
               Margin="16,16,0,12"/>

        <CollectionView
            Grid.Row="1"
            ItemsSource="{Binding Conversations}"
            SelectionMode="Single"
            SelectionChanged="OnConversationSelected">

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="vm:ConversationItemViewModel">

                    <Grid Padding="12"
                          ColumnDefinitions="60,*,Auto"
                          BackgroundColor="#ffffffff"
                          Margin="10"
                          HeightRequest="80">

                        <!-- AVATAR -->
                        <Frame WidthRequest="50"
                               HeightRequest="50"
                               CornerRadius="25"
                               BackgroundColor="#2563EB"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               Padding="0">

                            <Label Text="{Binding DisplayInitial}"
                                   FontSize="22"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalOptions="Fill"
                                   VerticalOptions="Fill"
                                   HorizontalTextAlignment="Center"
                                   VerticalTextAlignment="Center" />
                        </Frame>

                        <!-- INFOS -->
                        <VerticalStackLayout Grid.Column="1"
                                             Padding="12,0"
                                             Spacing="4"
                                             VerticalOptions="Center">

                            <!-- NOM -->
                            <Label Text="{Binding DisplayName}"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="#111827"/>

                            <!-- DERNIER MESSAGE -->
                            <Label Text="{Binding DernierMessage.Contenu, 
                                          TargetNullValue='(Aucun message)'}"
                                   FontSize="14"
                                   TextColor="#6B7280"
                                   MaxLines="1"/>
                        </VerticalStackLayout>

                        <!-- ICONE VU / NON VU -->
                        <Image Grid.Column="2"
                               WidthRequest="22"
                               HeightRequest="22"
                               VerticalOptions="Center"
                               Source="{Binding DernierMessage.EstVu, 
                                                Converter={StaticResource MessageSeenIconConverter}}"/>
                    </Grid>

                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

    </Grid>

</ContentPage>
