<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    x:Class="SyndicApp.Mobile.Views.Communication.ConversationsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:SyndicApp.Mobile.ViewModels.Communication"
    xmlns:layout="clr-namespace:SyndicApp.Mobile.Views.Layout"
    x:DataType="vm:ConversationsListViewModel"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <layout:RoleDrawerLayout>

        <layout:RoleDrawerLayout.MainContent>

            <VerticalStackLayout Padding="16">

                <Label Text="Conversations"
                       FontAttributes="Bold"
                       FontSize="26"
                       Margin="0,0,0,12" />

                <!-- ðŸš¨ LA SEULE SOLUTION FIABLE -->
                <CollectionView
                        x:Name="ConvList"
                        ItemsSource="{Binding Conversations}"
                        SelectionMode="Single"
                        SelectionChanged="OnConversationSelected">

                    <CollectionView.ItemTemplate>
                        <DataTemplate>

                            <Grid Padding="12"
                                  BackgroundColor="#F9FAFB"
                                  ColumnDefinitions="60,*"
                                  Margin="0,0,0,12"
                                  HeightRequest="70">

                                <!-- Avatar -->
                                <Frame WidthRequest="48"
                                       HeightRequest="48"
                                       CornerRadius="24"
                                       BackgroundColor="#2563EB"
                                       VerticalOptions="Center">
                                    <Label Text="{Binding Participants[1].NomComplet}"
                                           TextColor="White"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Frame>

                                <!-- Info -->
                                <VerticalStackLayout Grid.Column="1" Padding="10,0">
                                    <Label Text="{Binding Participants[1].NomComplet}"
                                           FontSize="18"
                                           FontAttributes="Bold"/>

                                    <Label Text="{Binding DernierMessage.Contenu}"
                                           MaxLines="1"
                                           TextColor="#6B7280"/>
                                </VerticalStackLayout>

                            </Grid>

                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                </CollectionView>

            </VerticalStackLayout>

        </layout:RoleDrawerLayout.MainContent>

    </layout:RoleDrawerLayout>

</ContentPage>
